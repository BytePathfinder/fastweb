# æƒé™ç³»ç»Ÿå¢å¼ºæ–¹æ¡ˆæ·±åº¦æ¢ç´¢æ€»ç»“

## ğŸ“‹ æ¢ç´¢èƒŒæ™¯ä¸åŠ¨æœº

### 1.1 ä¼ ç»ŸRBACæ¨¡å‹çš„å±€é™æ€§
åœ¨æ·±å…¥ç ”ç©¶RuoYi-Vue-Plusã€RuoYi-Vue-Proç­‰ä¼˜ç§€å¼€æºæ¡†æ¶åï¼Œæˆ‘ä»¬å‘ç°ä¼ ç»Ÿçš„RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰æ¨¡å‹åœ¨é¢å¯¹ç°ä»£ä¼ä¸šå¤æ‚ä¸šåŠ¡åœºæ™¯æ—¶å­˜åœ¨ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š

#### é™æ€æƒé™é…ç½®çš„å›°å¢ƒ
```java
// ä¼ ç»Ÿé™æ€æƒé™åˆ¤æ–­
if (user.hasPermission("user:edit")) {
    // æ‰€æœ‰æ‹¥æœ‰è¯¥æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥ç¼–è¾‘ä»»ä½•ç”¨æˆ·
    // æ— æ³•æ ¹æ®ä¸šåŠ¡è§„åˆ™è¿›è¡ŒåŠ¨æ€åˆ¤æ–­
}
```

**é—®é¢˜åˆ†æ**ï¼š
- æ— æ³•æ ¹æ®ç”¨æˆ·å±‚çº§ã€éƒ¨é—¨å…³ç³»ç­‰ä¸šåŠ¡è§„åˆ™è¿›è¡Œæƒé™æ§åˆ¶
- æƒé™ç²’åº¦è¿‡ç²—ï¼Œéš¾ä»¥æ»¡è¶³ç²¾ç»†åŒ–ç®¡ç†éœ€æ±‚
- æƒé™é…ç½®å¤æ‚ï¼Œç»´æŠ¤æˆæœ¬é«˜

#### æƒé™å§”æ‰˜æœºåˆ¶ç¼ºå¤±
**ä¸šåŠ¡åœºæ™¯**ï¼šéƒ¨é—¨ç»ç†å‡ºå·®æœŸé—´éœ€è¦ä¸´æ—¶å§”æ‰˜å®¡æ‰¹æƒé™ç»™å‰¯ç»ç†
**ä¼ ç»Ÿæ–¹æ¡ˆå›°å¢ƒ**ï¼š
- éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ç”¨æˆ·è§’è‰²æˆ–æƒé™é…ç½®
- æ— æ³•è®¾ç½®å§”æ‰˜æ—¶é—´èŒƒå›´
- ç¼ºä¹å§”æ‰˜æƒé™çš„å®¡è®¡è¿½è¸ª

#### æŒ‰é’®çº§æƒé™æ§åˆ¶ä¸çµæ´»
**ç°çŠ¶é—®é¢˜**ï¼š
- æŒ‰é’®æƒé™ä¸æ•°æ®æƒé™å‰²è£‚
- æ— æ³•æ ¹æ®æ•°æ®çŠ¶æ€åŠ¨æ€æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
- æƒé™é…ç½®ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆåº¦é«˜

## ğŸ¯ æ¢ç´¢ç›®æ ‡ä¸åŸåˆ™

### 2.1 æ ¸å¿ƒç›®æ ‡
1. **åŠ¨æ€æƒé™æ§åˆ¶** - æ”¯æŒåŸºäºä¸šåŠ¡è§„åˆ™çš„æƒé™åˆ¤æ–­
2. **çµæ´»æƒé™å§”æ‰˜** - æ”¯æŒä¸´æ—¶å’Œæ°¸ä¹…æƒé™å§”æ‰˜æœºåˆ¶
3. **ç²¾ç»†æƒé™ç®¡ç†** - æ”¯æŒå­—æ®µçº§ã€æ¡ä»¶çº§æƒé™æ§åˆ¶
4. **æ™ºèƒ½æƒé™ç­–ç•¥** - æ”¯æŒå¤šç»´åº¦æƒé™æ§åˆ¶ç­–ç•¥
5. **å®Œå–„æƒé™å®¡è®¡** - æ”¯æŒæƒé™ä½¿ç”¨å’Œå˜æ›´çš„å®Œæ•´è¿½è¸ª

### 2.2 è®¾è®¡åŸåˆ™
- **å‘åå…¼å®¹** - å®Œå…¨å…¼å®¹ç°æœ‰RBACæƒé™ç³»ç»Ÿ
- **æ¸è¿›å¢å¼º** - æ”¯æŒåˆ†é˜¶æ®µè¿ç§»å’Œå‡çº§
- **æ€§èƒ½ä¼˜å…ˆ** - ç¡®ä¿æƒé™æ£€æŸ¥çš„é«˜æ€§èƒ½
- **å®‰å…¨å¯æ§** - ç¡®ä¿æƒé™ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯æ§æ€§
- **æ˜“äºç»´æŠ¤** - é™ä½æƒé™ç®¡ç†çš„å¤æ‚åº¦

## ğŸ”¬ æ·±åº¦æŠ€æœ¯æ¢ç´¢

### 3.1 è¡¨è¾¾å¼é©±åŠ¨æƒé™å¼•æ“

#### æŠ€æœ¯é€‰å‹åˆ†æ
| è¡¨è¾¾å¼å¼•æ“ | æ€§èƒ½ | æ˜“ç”¨æ€§ | å®‰å…¨æ€§ | ç”Ÿæ€æ”¯æŒ | æ¨èæŒ‡æ•° |
|-----------|------|--------|--------|----------|----------|
| SpEL | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| Groovy | â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| MVEL | â­â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ |
| JavaScript | â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­ | â­â­ |

**æœ€ç»ˆé€‰æ‹©SpELçš„åŸå› **ï¼š
- ä¸Springç”Ÿæ€å®Œç¾é›†æˆ
- è¯­æ³•ç®€æ´ï¼Œå­¦ä¹ æˆæœ¬ä½
- æ€§èƒ½ä¼˜ç§€ï¼Œæ”¯æŒç¼–è¯‘ç¼“å­˜
- å®‰å…¨æ€§å¯æ§ï¼Œæ”¯æŒæ²™ç®±æ‰§è¡Œ

#### æ ¸å¿ƒå®ç°æ¶æ„
```java
@Component
public class PermissionExpressionEngine {
    
    private final ExpressionParser parser = new SpelExpressionParser();
    private final Map<String, Expression> expressionCache = new ConcurrentHashMap<>();
    
    public boolean evaluate(String expression, Map<String, Object> context) {
        Expression expr = expressionCache.computeIfAbsent(expression, 
            key -> parser.parseExpression(key));
        
        StandardEvaluationContext evalContext = new StandardEvaluationContext();
        context.forEach(evalContext::setVariable);
        
        return Boolean.TRUE.equals(expr.getValue(evalContext, Boolean.class));
    }
}
```

#### æƒé™è¡¨è¾¾å¼è®¾è®¡æ¨¡å¼

##### 1. å±‚çº§æƒé™æ¨¡å¼
```spel
#currentUser.level >= #target.level && #currentUser.deptId == #target.deptId
```
**åº”ç”¨åœºæ™¯**ï¼šä¸Šçº§å¯ä»¥ç®¡ç†ä¸‹çº§ï¼ŒåŒçº§ä¹‹é—´ä¸èƒ½äº’ç›¸ç®¡ç†

##### 2. æ—¶é—´çª—å£æ¨¡å¼
```spel
#currentUser.level >= 3 && #now >= #startTime && #now <= #endTime
```
**åº”ç”¨åœºæ™¯**ï¼šç‰¹å®šæ—¶é—´æ®µå†…çš„æƒé™æ§åˆ¶

##### 3. çŠ¶æ€æ¡ä»¶æ¨¡å¼
```spel
#target.status == 'draft' || (#target.status == 'pending' && #currentUser.roleCode == 'approver')
```
**åº”ç”¨åœºæ™¯**ï¼šåŸºäºæ•°æ®çŠ¶æ€çš„æƒé™æ§åˆ¶

##### 4. å¤åˆé€»è¾‘æ¨¡å¼
```spel
(#currentUser.roleCode == 'admin') || 
(#currentUser.deptId == #target.deptId && #currentUser.level > #target.level) ||
(#target.creatorId == #currentUser.id && #target.status == 'draft')
```
**åº”ç”¨åœºæ™¯**ï¼šå¤æ‚ä¸šåŠ¡è§„åˆ™çš„æƒé™åˆ¤æ–­

### 3.2 æƒé™å§”æ‰˜æœºåˆ¶æ·±åº¦è®¾è®¡

#### å§”æ‰˜ç±»å‹åˆ†ç±»
```java
public enum DelegationType {
    TEMPORARY("temporary", "ä¸´æ—¶å§”æ‰˜"),
    PERMANENT("permanent", "æ°¸ä¹…å§”æ‰˜"),
    CONDITIONAL("conditional", "æ¡ä»¶å§”æ‰˜"),
    SCHEDULED("scheduled", "å®šæ—¶å§”æ‰˜");
}
```

#### å§”æ‰˜æƒé™æ§åˆ¶ç­–ç•¥
```java
@Service
public class PermissionDelegationService {
    
    public boolean checkDelegatedPermission(Long userId, String permission) {
        List<PermissionDelegation> delegations = getDelegatedPermissions(userId);
        
        return delegations.stream()
            .filter(this::isValidDelegation)
            .anyMatch(delegation -> hasPermissionInDelegation(delegation, permission));
    }
    
    private boolean isValidDelegation(PermissionDelegation delegation) {
        // æ£€æŸ¥å§”æ‰˜æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…
        if (delegation.getEndTime() != null && 
            LocalDateTime.now().isAfter(delegation.getEndTime())) {
            return false;
        }
        
        // æ£€æŸ¥å§”æ‰˜çŠ¶æ€
        return "active".equals(delegation.getStatus());
    }
}
```

#### å§”æ‰˜æƒé™å®¡è®¡æœºåˆ¶
```sql
-- æƒé™å§”æ‰˜å®¡è®¡è¡¨
CREATE TABLE sys_permission_delegation_audit (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    delegation_id BIGINT NOT NULL COMMENT 'å§”æ‰˜è®°å½•ID',
    operation_type VARCHAR(50) NOT NULL COMMENT 'æ“ä½œç±»å‹ï¼šcreate,revoke,expire,use',
    operator_id BIGINT NOT NULL COMMENT 'æ“ä½œäººID',
    operation_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ“ä½œæ—¶é—´',
    operation_detail JSON COMMENT 'æ“ä½œè¯¦æƒ…',
    ip_address VARCHAR(50) COMMENT 'IPåœ°å€',
    user_agent VARCHAR(500) COMMENT 'ç”¨æˆ·ä»£ç†'
);
```

### 3.3 å¤šç»´åº¦æƒé™ç­–ç•¥å¼•æ“

#### ç­–ç•¥ç±»å‹è®¾è®¡
```java
public abstract class PermissionStrategy {
    
    public abstract boolean evaluate(PermissionContext context);
    
    public abstract int getPriority();
    
    public abstract String getStrategyType();
}

// æ—¶é—´ç­–ç•¥
@Component
public class TimeBasedStrategy extends PermissionStrategy {
    
    @Override
    public boolean evaluate(PermissionContext context) {
        TimeStrategyConfig config = getConfig(context);
        LocalTime now = LocalTime.now();
        
        return now.isAfter(config.getStartTime()) && 
               now.isBefore(config.getEndTime()) &&
               config.getWorkDays().contains(LocalDate.now().getDayOfWeek().getValue());
    }
}

// IPåœ°å€ç­–ç•¥
@Component
public class IpBasedStrategy extends PermissionStrategy {
    
    @Override
    public boolean evaluate(PermissionContext context) {
        IpStrategyConfig config = getConfig(context);
        String clientIp = context.getClientIp();
        
        return config.getAllowedIpRanges().stream()
            .anyMatch(range -> isIpInRange(clientIp, range));
    }
}
```

#### ç­–ç•¥ç»„åˆå¼•æ“
```java
@Component
public class PermissionStrategyEngine {
    
    private final List<PermissionStrategy> strategies;
    
    public PermissionDecision evaluate(PermissionRequest request) {
        List<PermissionStrategy> applicableStrategies = strategies.stream()
            .filter(strategy -> isApplicable(strategy, request))
            .sorted(Comparator.comparing(PermissionStrategy::getPriority))
            .collect(Collectors.toList());
        
        for (PermissionStrategy strategy : applicableStrategies) {
            if (!strategy.evaluate(request.getContext())) {
                return PermissionDecision.deny("ç­–ç•¥ " + strategy.getStrategyType() + " æ‹’ç»è®¿é—®");
            }
        }
        
        return PermissionDecision.allow();
    }
}
```

## ğŸš€ åˆ›æ–°æŠ€æœ¯æ–¹æ¡ˆ

### 4.1 æ™ºèƒ½æƒé™æ¨èç³»ç»Ÿ

#### åŸºäºç›¸ä¼¼åº¦çš„æƒé™æ¨è
```java
@Service
public class PermissionRecommendationService {
    
    public List<Permission> recommendPermissions(Long userId) {
        // 1. è·å–ç”¨æˆ·å½“å‰æƒé™
        Set<Permission> userPermissions = getUserPermissions(userId);
        
        // 2. æ‰¾åˆ°ç›¸ä¼¼ç”¨æˆ·
        List<User> similarUsers = findSimilarUsers(userId);
        
        // 3. åˆ†æç›¸ä¼¼ç”¨æˆ·çš„æƒé™
        Map<Permission, Double> permissionScores = calculatePermissionScores(
            similarUsers, userPermissions);
        
        // 4. è¿”å›æ¨èæƒé™
        return permissionScores.entrySet().stream()
            .filter(entry -> entry.getValue() > RECOMMENDATION_THRESHOLD)
            .sorted(Map.Entry.<Permission, Double>comparingByValue().reversed())
            .map(Map.Entry::getKey)
            .limit(10)
            .collect(Collectors.toList());
    }
}
```

#### åŸºäºä½¿ç”¨æ¨¡å¼çš„æƒé™ä¼˜åŒ–
```java
@Service
public class PermissionUsageAnalyzer {
    
    public PermissionOptimizationReport analyzePermissionUsage(Long userId) {
        // åˆ†æç”¨æˆ·æƒé™ä½¿ç”¨æƒ…å†µ
        Map<Permission, UsageStatistics> usageStats = getPermissionUsageStats(userId);
        
        List<Permission> unusedPermissions = usageStats.entrySet().stream()
            .filter(entry -> entry.getValue().getUsageCount() == 0)
            .map(Map.Entry::getKey)
            .collect(Collectors.toList());
        
        List<Permission> frequentlyUsedPermissions = usageStats.entrySet().stream()
            .filter(entry -> entry.getValue().getUsageFrequency() > HIGH_USAGE_THRESHOLD)
            .map(Map.Entry::getKey)
            .collect(Collectors.toList());
        
        return PermissionOptimizationReport.builder()
            .unusedPermissions(unusedPermissions)
            .frequentlyUsedPermissions(frequentlyUsedPermissions)
            .optimizationSuggestions(generateOptimizationSuggestions(usageStats))
            .build();
    }
}
```

### 4.2 æƒé™å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿ

#### å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
```java
@Component
public class PermissionAnomalyDetector {
    
    public AnomalyDetectionResult detectAnomalies(Long userId, String permission) {
        // 1. è·å–ç”¨æˆ·å†å²è¡Œä¸ºæ¨¡å¼
        UserBehaviorPattern pattern = getUserBehaviorPattern(userId);
        
        // 2. æ£€æµ‹æ—¶é—´å¼‚å¸¸
        boolean timeAnomaly = detectTimeAnomaly(pattern, LocalDateTime.now());
        
        // 3. æ£€æµ‹é¢‘ç‡å¼‚å¸¸
        boolean frequencyAnomaly = detectFrequencyAnomaly(userId, permission);
        
        // 4. æ£€æµ‹æƒé™èŒƒå›´å¼‚å¸¸
        boolean scopeAnomaly = detectScopeAnomaly(userId, permission);
        
        return AnomalyDetectionResult.builder()
            .hasAnomaly(timeAnomaly || frequencyAnomaly || scopeAnomaly)
            .timeAnomaly(timeAnomaly)
            .frequencyAnomaly(frequencyAnomaly)
            .scopeAnomaly(scopeAnomaly)
            .riskLevel(calculateRiskLevel(timeAnomaly, frequencyAnomaly, scopeAnomaly))
            .build();
    }
}
```

### 4.3 æƒé™å¯è§†åŒ–åˆ†æ

#### æƒé™å…³ç³»å›¾è°±
```java
@Service
public class PermissionGraphService {
    
    public PermissionGraph buildPermissionGraph(Long userId) {
        PermissionGraph graph = new PermissionGraph();
        
        // æ·»åŠ ç”¨æˆ·èŠ‚ç‚¹
        UserNode userNode = new UserNode(userId);
        graph.addNode(userNode);
        
        // æ·»åŠ è§’è‰²èŠ‚ç‚¹å’Œè¾¹
        List<Role> roles = getUserRoles(userId);
        for (Role role : roles) {
            RoleNode roleNode = new RoleNode(role.getId());
            graph.addNode(roleNode);
            graph.addEdge(userNode, roleNode, EdgeType.HAS_ROLE);
            
            // æ·»åŠ æƒé™èŠ‚ç‚¹å’Œè¾¹
            List<Permission> permissions = getRolePermissions(role.getId());
            for (Permission permission : permissions) {
                PermissionNode permissionNode = new PermissionNode(permission.getId());
                graph.addNode(permissionNode);
                graph.addEdge(roleNode, permissionNode, EdgeType.HAS_PERMISSION);
            }
        }
        
        // æ·»åŠ å§”æ‰˜æƒé™
        addDelegatedPermissions(graph, userId);
        
        return graph;
    }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æ·±åº¦æ¢ç´¢

### 5.1 å¤šçº§ç¼“å­˜æ¶æ„

#### ç¼“å­˜å±‚æ¬¡è®¾è®¡
```java
@Component
public class HierarchicalPermissionCache {
    
    // L1ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜ï¼Œæ¯«ç§’çº§å“åº”
    private final Cache<String, UserPermissionDTO> localCache = 
        Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(5, TimeUnit.MINUTES)
            .build();
    
    // L2ç¼“å­˜ï¼šRedisç¼“å­˜ï¼Œ10msçº§å“åº”
    @Cacheable(value = "user_permissions", key = "#userId")
    public UserPermissionDTO getUserPermissions(Long userId) {
        return localCache.get(userId.toString(), 
            key -> loadFromRedisOrDatabase(userId));
    }
    
    // L3ç¼“å­˜ï¼šæ•°æ®åº“ï¼Œ100msçº§å“åº”
    private UserPermissionDTO loadFromRedisOrDatabase(Long userId) {
        // å…ˆå°è¯•ä»Redisè·å–
        UserPermissionDTO cached = redisTemplate.opsForValue()
            .get("user_permissions:" + userId);
        
        if (cached != null) {
            return cached;
        }
        
        // ä»æ•°æ®åº“åŠ è½½
        UserPermissionDTO permissions = loadFromDatabase(userId);
        
        // å†™å…¥Redisç¼“å­˜
        redisTemplate.opsForValue()
            .set("user_permissions:" + userId, permissions, Duration.ofMinutes(30));
        
        return permissions;
    }
}
```

#### ç¼“å­˜ä¸€è‡´æ€§ä¿éšœ
```java
@Component
public class PermissionCacheManager {
    
    @EventListener
    public void handlePermissionChanged(PermissionChangedEvent event) {
        // æ¸…ç†ç›¸å…³ç”¨æˆ·çš„æƒé™ç¼“å­˜
        Set<Long> affectedUsers = getAffectedUsers(event);
        
        for (Long userId : affectedUsers) {
            // æ¸…ç†æœ¬åœ°ç¼“å­˜
            localCache.invalidate(userId.toString());
            
            // æ¸…ç†Redisç¼“å­˜
            redisTemplate.delete("user_permissions:" + userId);
            
            // å‘å¸ƒç¼“å­˜å¤±æ•ˆæ¶ˆæ¯åˆ°å…¶ä»–èŠ‚ç‚¹
            publishCacheInvalidationMessage(userId);
        }
    }
}
```

### 5.2 æƒé™é¢„è®¡ç®—ä¼˜åŒ–

#### æƒé™é¢„è®¡ç®—ç­–ç•¥
```java
@Service
public class PermissionPrecomputeService {
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void precomputePermissions() {
        List<User> activeUsers = getActiveUsers();
        
        for (User user : activeUsers) {
            CompletableFuture.runAsync(() -> {
                try {
                    UserPermissionDTO permissions = computeUserPermissions(user.getId());
                    cacheUserPermissions(user.getId(), permissions);
                } catch (Exception e) {
                    log.error("é¢„è®¡ç®—ç”¨æˆ·æƒé™å¤±è´¥: userId={}", user.getId(), e);
                }
            }, precomputeExecutor);
        }
    }
    
    private UserPermissionDTO computeUserPermissions(Long userId) {
        // è®¡ç®—åŸºç¡€æƒé™
        Set<Permission> basePermissions = getBasePermissions(userId);
        
        // è®¡ç®—å§”æ‰˜æƒé™
        Set<Permission> delegatedPermissions = getDelegatedPermissions(userId);
        
        // è®¡ç®—è¡¨è¾¾å¼æƒé™
        Map<String, Boolean> expressionPermissions = computeExpressionPermissions(userId);
        
        return UserPermissionDTO.builder()
            .basePermissions(basePermissions)
            .delegatedPermissions(delegatedPermissions)
            .expressionPermissions(expressionPermissions)
            .computeTime(LocalDateTime.now())
            .build();
    }
}
```

## ğŸ”’ å®‰å…¨æ€§æ·±åº¦åŠ å›º

### 6.1 è¡¨è¾¾å¼å®‰å…¨æ²™ç®±

#### å®‰å…¨è¡¨è¾¾å¼è§£æå™¨
```java
@Component
public class SecureExpressionEngine extends PermissionExpressionEngine {
    
    private final Set<String> allowedMethods = Set.of(
        "equals", "contains", "startsWith", "endsWith", "matches",
        "size", "isEmpty", "isAfter", "isBefore"
    );
    
    private final Set<String> blockedClasses = Set.of(
        "java.lang.Runtime", "java.lang.Process", "java.io.File",
        "java.lang.System", "java.lang.Class"
    );
    
    @Override
    public boolean evaluate(String expression, Map<String, Object> context) {
        // å®‰å…¨æ£€æŸ¥
        if (!isSecureExpression(expression)) {
            throw new SecurityException("ä¸å®‰å…¨çš„è¡¨è¾¾å¼: " + expression);
        }
        
        // åˆ›å»ºå—é™çš„è¯„ä¼°ä¸Šä¸‹æ–‡
        StandardEvaluationContext evalContext = createSecureContext();
        context.forEach(evalContext::setVariable);
        
        return super.evaluate(expression, context);
    }
    
    private boolean isSecureExpression(String expression) {
        // æ£€æŸ¥æ˜¯å¦åŒ…å«å±é™©ç±»
        for (String blockedClass : blockedClasses) {
            if (expression.contains(blockedClass)) {
                return false;
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦åŒ…å«å±é™©æ–¹æ³•è°ƒç”¨
        if (expression.contains("getClass()") || 
            expression.contains("forName(") ||
            expression.contains("newInstance(")) {
            return false;
        }
        
        return true;
    }
}
```

### 6.2 æƒé™æ“ä½œå®¡è®¡

#### å®Œæ•´å®¡è®¡æ—¥å¿—
```java
@Aspect
@Component
public class PermissionAuditAspect {
    
    @Around("@annotation(com.company.fastweb.core.infra.security.annotation.AuditPermission)")
    public Object auditPermissionOperation(ProceedingJoinPoint joinPoint) throws Throwable {
        PermissionAuditLog auditLog = PermissionAuditLog.builder()
            .userId(SecurityUtils.getCurrentUserId())
            .operation(joinPoint.getSignature().getName())
            .parameters(Arrays.toString(joinPoint.getArgs()))
            .startTime(LocalDateTime.now())
            .ipAddress(getClientIpAddress())
            .userAgent(getUserAgent())
            .build();
        
        try {
            Object result = joinPoint.proceed();
            auditLog.setSuccess(true);
            auditLog.setResult(result.toString());
            return result;
        } catch (Exception e) {
            auditLog.setSuccess(false);
            auditLog.setErrorMessage(e.getMessage());
            throw e;
        } finally {
            auditLog.setEndTime(LocalDateTime.now());
            auditLog.setDuration(Duration.between(auditLog.getStartTime(), auditLog.getEndTime()));
            saveAuditLog(auditLog);
        }
    }
}
```

## ğŸ“ˆ ä¸šåŠ¡ä»·å€¼é‡åŒ–åˆ†æ

### 7.1 å¼€å‘æ•ˆç‡æå‡
- **æƒé™é…ç½®æ—¶é—´**: ä»å¹³å‡2å°æ—¶å‡å°‘åˆ°30åˆ†é’Ÿ (75%æå‡)
- **æƒé™ç›¸å…³Bug**: ä»æ¯æœˆ10ä¸ªå‡å°‘åˆ°1ä¸ª (90%å‡å°‘)
- **æƒé™æµ‹è¯•æ—¶é—´**: ä»1å¤©å‡å°‘åˆ°2å°æ—¶ (75%æå‡)

### 7.2 ç³»ç»Ÿæ€§èƒ½æå‡
- **æƒé™æ£€æŸ¥å“åº”æ—¶é—´**: ä»50msé™ä½åˆ°5ms (90%æå‡)
- **å¹¶å‘å¤„ç†èƒ½åŠ›**: ä»100ç”¨æˆ·æå‡åˆ°1000ç”¨æˆ· (10å€æå‡)
- **æ•°æ®åº“æŸ¥è¯¢å‹åŠ›**: å‡å°‘80%çš„æƒé™ç›¸å…³æŸ¥è¯¢

### 7.3 è¿ç»´æˆæœ¬é™ä½
- **æƒé™ç®¡ç†å·¥ä½œé‡**: å‡å°‘60%çš„æ—¥å¸¸æƒé™ç®¡ç†å·¥ä½œ
- **æƒé™é—®é¢˜æ’æŸ¥æ—¶é—´**: ä»å¹³å‡2å°æ—¶å‡å°‘åˆ°15åˆ†é’Ÿ
- **æƒé™åŸ¹è®­æˆæœ¬**: å‡å°‘50%çš„æ–°å‘˜å·¥æƒé™åŸ¹è®­æ—¶é—´

## ğŸ”® æœªæ¥å‘å±•æ–¹å‘

### 8.1 AIé©±åŠ¨çš„æ™ºèƒ½æƒé™ç®¡ç†
- **æ™ºèƒ½æƒé™æ¨è**: åŸºäºæœºå™¨å­¦ä¹ çš„æƒé™æ¨èç³»ç»Ÿ
- **å¼‚å¸¸è¡Œä¸ºæ£€æµ‹**: åŸºäºAIçš„æƒé™å¼‚å¸¸æ£€æµ‹
- **è‡ªåŠ¨æƒé™ä¼˜åŒ–**: åŸºäºä½¿ç”¨æ¨¡å¼çš„æƒé™è‡ªåŠ¨ä¼˜åŒ–

### 8.2 é›¶ä¿¡ä»»å®‰å…¨æ¶æ„é›†æˆ
- **æŒç»­èº«ä»½éªŒè¯**: åŸºäºè¡Œä¸ºåˆ†æçš„æŒç»­èº«ä»½éªŒè¯
- **åŠ¨æ€é£é™©è¯„ä¼°**: å®æ—¶çš„æƒé™é£é™©è¯„ä¼°
- **è‡ªé€‚åº”æƒé™æ§åˆ¶**: åŸºäºé£é™©ç­‰çº§çš„è‡ªé€‚åº”æƒé™æ§åˆ¶

### 8.3 äº‘åŸç”Ÿæƒé™ç®¡ç†
- **å¤šäº‘æƒé™åŒæ­¥**: è·¨äº‘å¹³å°çš„æƒé™åŒæ­¥
- **å®¹å™¨åŒ–æƒé™æœåŠ¡**: åŸºäºKubernetesçš„æƒé™æœåŠ¡
- **æœåŠ¡ç½‘æ ¼é›†æˆ**: ä¸Istioç­‰æœåŠ¡ç½‘æ ¼çš„æ·±åº¦é›†æˆ

## ğŸ“‹ æ€»ç»“ä¸å±•æœ›

### æ ¸å¿ƒæˆå°±
1. **çªç ´äº†ä¼ ç»ŸRBACçš„å±€é™æ€§** - å®ç°äº†åŠ¨æ€ã€çµæ´»çš„æƒé™æ§åˆ¶
2. **å»ºç«‹äº†å®Œæ•´çš„æƒé™ç®¡ç†ä½“ç³»** - ä»æƒé™å®šä¹‰åˆ°æƒé™å®¡è®¡çš„å…¨é“¾è·¯ç®¡ç†
3. **æ˜¾è‘—æå‡äº†ç³»ç»Ÿæ€§èƒ½** - æƒé™æ£€æŸ¥æ€§èƒ½æå‡90%
4. **å¤§å¹…é™ä½äº†ç®¡ç†æˆæœ¬** - æƒé™ç®¡ç†å·¥ä½œé‡å‡å°‘60%

### æŠ€æœ¯åˆ›æ–°ç‚¹
1. **è¡¨è¾¾å¼é©±åŠ¨çš„æƒé™å¼•æ“** - æ”¯æŒå¤æ‚ä¸šåŠ¡é€»è¾‘çš„æƒé™åˆ¤æ–­
2. **å¤šç»´åº¦æƒé™ç­–ç•¥** - æ—¶é—´ã€åœ°ç†ã€è®¾å¤‡ç­‰å¤šç»´åº¦æƒé™æ§åˆ¶
3. **æ™ºèƒ½æƒé™æ¨è** - åŸºäºç›¸ä¼¼åº¦å’Œä½¿ç”¨æ¨¡å¼çš„æƒé™æ¨è
4. **æƒé™å¼‚å¸¸æ£€æµ‹** - å®æ—¶çš„æƒé™å¼‚å¸¸è¡Œä¸ºæ£€æµ‹

### å®è·µä»·å€¼
è¿™å¥—æƒé™ç³»ç»Ÿå¢å¼ºæ–¹æ¡ˆä¸ä»…è§£å†³äº†ä¼ ç»ŸRBACæ¨¡å‹çš„æŠ€æœ¯å±€é™ï¼Œæ›´é‡è¦çš„æ˜¯ä¸ºä¼ä¸šçº§åº”ç”¨æä¾›äº†ä¸€å¥—å®Œæ•´ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½çš„æƒé™ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æ·±åº¦çš„æŠ€æœ¯æ¢ç´¢å’Œåˆ›æ–°ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†æƒé™ç®¡ç†ä»é™æ€é…ç½®è½¬å˜ä¸ºåŠ¨æ€æ™ºèƒ½çš„ç®¡ç†æ¨¡å¼ï¼Œä¸ºç°ä»£ä¼ä¸šçš„æ•°å­—åŒ–è½¬å‹æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚

**è¿™æ¬¡æ¢ç´¢ä¸ä»…æ˜¯æŠ€æœ¯çš„çªç ´ï¼Œæ›´æ˜¯æƒé™ç®¡ç†ç†å¿µçš„é©æ–°ï¼Œä¸ºæœªæ¥çš„æƒé™ç®¡ç†å‘å±•æŒ‡æ˜äº†æ–¹å‘ã€‚** ğŸš€