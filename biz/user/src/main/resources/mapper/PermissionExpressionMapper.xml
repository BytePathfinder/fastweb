<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.company.fastweb.biz.user.mapper.PermissionExpressionMapper">

    <resultMap id="BaseResultMap" type="com.company.fastweb.biz.user.entity.PermissionExpression">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="permission_id" property="permissionId" jdbcType="BIGINT"/>
        <result column="permission_code" property="permissionCode" jdbcType="VARCHAR"/>
        <result column="expression_name" property="expressionName" jdbcType="VARCHAR"/>
        <result column="expression_content" property="expressionContent" jdbcType="LONGVARCHAR"/>
        <result column="expression_type" property="expressionType" jdbcType="VARCHAR"/>
        <result column="variables" property="variables" jdbcType="LONGVARCHAR"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="TINYINT"/>
        <result column="tenant_id" property="tenantId" jdbcType="BIGINT"/>
        <result column="creator" property="creator" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="updater" property="updater" jdbcType="VARCHAR"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="deleted" property="deleted" jdbcType="TINYINT"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, permission_id, permission_code, expression_name, expression_content, expression_type,
        variables, description, status, tenant_id, creator, create_time, updater, update_time, deleted
    </sql>

    <select id="selectByPermissionId" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM sys_permission_expression
        WHERE permission_id = #{permissionId} AND deleted = 0
    </select>

    <select id="selectByPermissionCode" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM sys_permission_expression
        WHERE permission_code = #{permissionCode} AND deleted = 0
    </select>

    <select id="selectAllEnabled" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM sys_permission_expression
        WHERE status = 1 AND deleted = 0
        ORDER BY create_time DESC
    </select>

    <insert id="insert" parameterType="com.company.fastweb.biz.user.entity.PermissionExpression" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sys_permission_expression (
            permission_id, permission_code, expression_name, expression_content, expression_type,
            variables, description, status, tenant_id, creator, create_time
        ) VALUES (
            #{permissionId}, #{permissionCode}, #{expressionName}, #{expressionContent}, #{expressionType},
            #{variables}, #{description}, #{status}, #{tenantId}, #{creator}, NOW()
        )
    </insert>

    <update id="updateById" parameterType="com.company.fastweb.biz.user.entity.PermissionExpression">
        UPDATE sys_permission_expression
        SET permission_id = #{permissionId},
            permission_code = #{permissionCode},
            expression_name = #{expressionName},
            expression_content = #{expressionContent},
            expression_type = #{expressionType},
            variables = #{variables},
            description = #{description},
            status = #{status},
            updater = #{updater},
            update_time = NOW()
        WHERE id = #{id} AND deleted = 0
    </update>

    <update id="deleteById">
        UPDATE sys_permission_expression
        SET deleted = 1, update_time = NOW()
        WHERE id = #{id}
    </update>

</mapper>