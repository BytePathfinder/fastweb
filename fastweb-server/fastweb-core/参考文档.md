# fastweb-core 精简版功能设计方案（12模块）

> 下面的文档旨在传达宏观的设计层面的概念，不是具体实现的具体代码！！！

## 实施优先级分层

### 🔥 核心基础层（Phase 1 - 必须优先实现）

#### 1. **fastweb-core-common**（公共基础模块）

**基础功能**：

- 通用工具类：DateUtils、StringUtils、JsonUtils、UUIDUtils、ConfigUtils
- 统一响应体：Result<T>、PageResult<T>、ApiResponse
- 基础实体类：BaseEntity（id、createTime、updateTime、createBy、updateBy）
- 枚举定义：StatusEnum、TypeEnum、DeleteEnum
- 常量定义：系统常量、错误码常量、配置键名常量
- **配置管理**：多环境配置加载、配置加密解密、动态配置刷新

**技术实现**：

```java
// 统一响应体
public class Result<T> {
    private Integer code;
    private String message;
    private T data;
    private Long timestamp;
}

// 基础实体
@MappedSuperclass
public class BaseEntity {
    private Long id;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
    private String createBy;
    private String updateBy;
    private Integer deleteFlag;
}

// 配置工具类（整合到common模块）
public class ConfigUtils {
    public static String getConfig(String key, String defaultValue) { ...}

    public static <T> T getConfigObject(String key, Class<T> clazz) { ...}
}
```

#### 2. **fastweb-core-exception**（异常处理模块）

**核心功能**：

- 全局异常处理：@ControllerAdvice + @ExceptionHandler
- 自定义异常体系：BaseException、BusinessException、ValidationException
- 错误码规范：A0001（用户端错误）、B0001（系统执行错误）、C0001（调用第三方错误）
- 异常信息国际化：支持多语言错误提示

**技术实现**：

```java

@ControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(BusinessException.class)
    public Result<Void> handleBusinessException(BusinessException e) {
        return Result.error(e.getCode(), e.getMessage());
    }
}
```

### 🚀 核心业务层（Phase 2 - 关键业务功能）

#### 3. **fastweb-core-security**（安全认证模块）

**认证授权**：

- JWT Token管理：生成、验证、刷新、黑名单
- RBAC权限模型：User-Role-Permission三表设计
- 注解式权限：@PreAuthorize、@HasRole、@HasPermission
- 密码策略：BCrypt加密、密码强度校验、历史密码检查

**安全防护**：

- XSS防护：输入参数HTML转义
- CSRF防护：Token验证
- SQL注入防护：参数化查询强制检查
- 接口限流：基于IP/用户的访问频率限制

#### 4. **fastweb-core-data**（数据访问模块）

**数据源管理**：

- 多数据源配置：@DataSource注解动态切换
- 读写分离：Master-Slave路由策略
- 分库分表：ShardingSphere集成

**ORM增强**：

- MyBatis-Plus集成：BaseMapper<T>、IService<T>
- 数据审计：@CreatedBy、@LastModifiedBy自动填充
- 软删除：逻辑删除拦截器
- 分页插件：统一分页参数和返回格式

#### 5. **fastweb-core-cache**（缓存管理模块）

**多级缓存**：

- 本地缓存：Caffeine一级缓存
- 分布式缓存：Redis二级缓存
- 缓存同步：本地缓存失效通知机制

**缓存策略**：

- 注解式缓存：@Cacheable、@CacheEvict、@CachePut增强版
- 缓存穿透：布隆过滤器 + 空值缓存
- 缓存雪崩：过期时间随机化
- 分布式锁：@DistributedLock注解，Redisson实现

### 🛠 扩展功能层（Phase 3 - 增强功能）

#### 6. **fastweb-core-storage**（文件存储模块）

**多存储适配**：

- 存储策略模式：LocalStorage、OSSStorage、MinIOStorage
- 统一存储接口：FileStorageService
- 存储配置：支持多个存储源配置和切换

**文件服务**：

- 文件上传：单文件、批量、分片上传
- 文件下载：支持断点续传、预签名URL
- 图片处理：缩略图生成、水印添加、格式转换
- 文件安全：文件类型检查、病毒扫描、访问权限控制

#### 7. **fastweb-core-message**（消息通信模块）

**消息中间件**：

- 统一消息接口：MessageProducer、MessageConsumer
- 多MQ适配：Kafka、RabbitMQ、RocketMQ适配器
- Spring Cloud Stream集成

**消息可靠性**：

- 事务消息：本地消息表 + 定时补偿
- 重试机制：指数退避重试策略
- 死信处理：失败消息转移到死信队列
- 消息追踪：消息轨迹追踪和监控

#### 8. **fastweb-core-task**（任务调度模块）

**任务调度**：

- 分布式调度：XXL-JOB、PowerJob集成选择
- 本地调度：@Scheduled增强版
- 延迟任务：Redis延迟队列、RocketMQ延迟消息

**任务管理**：

- 任务监控：执行状态、耗时统计、失败率
- 任务治理：任务依赖管理、任务分组
- 批处理：Spring Batch集成，大数据量处理

### 📊 监控运维层（Phase 4 - 监控告警）

#### 9. **fastweb-core-monitor**（监控告警模块）

**指标监控**：

- 指标采集：Micrometer + Prometheus
- 健康检查：数据库、Redis、消息队列连通性检查
- 自定义指标：业务指标埋点和采集

**链路追踪**：

- 分布式追踪：Spring Cloud Sleuth + Zipkin/Jaeger
- 日志关联：TraceId自动注入日志
- 性能分析：慢SQL检测、接口耗时分析

**告警通知**：

- 告警规则：阈值告警、异常告警
- 通知渠道：钉钉、飞书、邮件、短信
- 告警收敛：相同告警合并、告警静默

#### 10. **fastweb-core-audit**（审计日志模块）

**操作审计**：

- 操作日志：@AuditLog注解自动记录
- 登录审计：登录成功/失败、异地登录检测
- 数据变更：Hibernate Envers数据版本管理
- 敏感操作：权限变更、数据导出等关键操作

**日志管理**：

- 日志脱敏：手机号、身份证等敏感信息脱敏
- 日志检索：基于Elasticsearch的日志检索
- 日志归档：日志分级存储和定期清理

### 🔍 业务增强层（Phase 5 - 业务扩展）

#### 11. **fastweb-core-doc**（接口文档模块）

**文档生成**：

- OpenAPI3集成：SpringDoc增强配置
- 接口分组：按业务模块、版本分组
- 文档美化：Knife4j UI增强

**文档安全**：

- 访问控制：生产环境文档访问权限
- 接口Mock：基于文档的Mock数据生成
- 版本管理：API版本控制和兼容性检查

#### 12. **fastweb-core-tenant**（多租户模块）

**租户隔离**：

- 隔离策略：字段隔离、Schema隔离、数据库隔离
- 租户上下文：TenantContext + 拦截器自动注入
- 动态数据源：租户级别数据源路由

**租户管理**：

- 租户识别：Header、域名、Token多种识别方式
- 租户配置：独立的菜单、角色、权限配置
- 租户监控：租户级别的资源使用统计

## 实施建议

### 开发顺序

1. **Phase 1**：common → exception（1周）
2. **Phase 2**：security → data → cache（2-3周）
3. **Phase 3**：storage → message → task（2-3周）
4. **Phase 4**：monitor → audit（1-2周）
5. **Phase 5**：doc → tenant（1-2周）

### 技术选型

- **基础框架**：Spring Boot 2.7+ / Spring Cloud 2021+
- **数据库**：MySQL 8.0 + MyBatis-Plus 3.5+
- **缓存**：Redis 6.0 + Caffeine
- **消息队列**：RocketMQ / Kafka（根据业务选择）
- **监控**：Prometheus + Grafana + Jaeger

### 质量保证

- **单元测试**：每个模块覆盖率 > 80%
- **集成测试**：关键链路端到端测试
- **性能测试**：核心接口性能基准测试
- **安全测试**：安全漏洞扫描和修复

### 文档规范

- **设计文档**：每个模块的设计文档和接口定义
- **使用说明**：详细的使用示例和最佳实践
- **部署指南**：环境搭建和部署配置说明